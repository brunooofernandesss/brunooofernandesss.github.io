<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Saúde Coletiva, APS e Vigilância Epidemiológica.</title>
  <style>
    body { font-family: sans-serif; margin: 0; padding: 20px; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; background-color: #f4f4f4; }
    .quiz-container { max-width: 800px; width: 100%; }
    h1 { color: #333; text-align: center; margin-bottom: 30px; }
    .card { background-color: white; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }
    .question { font-weight: bold; margin-bottom: 10px; color: #333; }
    .options { margin-top: 15px; }
    .option, label.option, label, #newQuestionsContent label { display: flex; align-items: center; margin-bottom: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; cursor: pointer; transition: background-color 0.2s ease; position: relative; }
    .option input[type="radio"], label input[type="radio"], #newQuestionsContent input[type="radio"], #newQuestionsContent label input[type="radio"] { display: none !important; visibility: hidden !important; opacity: 0 !important; position: absolute !important; left: -9999px !important; }
    .option:hover, label.option:hover, label:hover, #newQuestionsContent label:hover { background-color: #e9e9e9; }
    .option.selected, label.option.selected, label.selected, #newQuestionsContent label.selected { background-color: #d1e7dd; border-color: #28a745; }
    .option.correct, label.option.correct, label.correct, #newQuestionsContent label.correct { background-color: #d4edda; border-color: #28a745; }
    .option.incorrect, label.option.incorrect, label.incorrect, #newQuestionsContent label.incorrect { background-color: #f8d7da; border-color: #dc3545; }
    .submit-btn { display: block; width: 100%; padding: 15px; background-color: #007bff; color: white; border: none; border-radius: 5px; font-size: 18px; cursor: pointer; transition: background-color 0.3s ease; margin-top: 30px; }
    .submit-btn:hover { background-color: #0056b3; }
    .results { text-align: center; margin-top: 30px; font-size: 20px; font-weight: bold; color: #333; }
    .scissor-icon { margin-right: 10px; width: 20px; height: 20px; opacity: 0.5; cursor: pointer; }
    .struck-through { text-decoration: line-through; color: #888; }
    .comment { margin-top: 10px; padding: 10px; background-color: #f0f0f0; border-left: 4px solid #007bff; font-style: italic; color: #555; display: none; }
    .comment.show { display: block; }
    .error-diagnosis-section { margin-top: 50px; padding: 30px; background-color: #ffe0b2; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.15); display: none; text-align: center; font-size: 1.1em; color: #333; }
    .error-diagnosis-section h2 { color: #e65100; margin-bottom: 20px; font-size: 1.8em; }
    .error-diagnosis-section ul { list-style: none; padding: 0; margin: 0; }
    .error-diagnosis-section li { background-color: #ff9800; color: white; padding: 8px 15px; margin: 8px 0; border-radius: 5px; display: inline-block; margin-right: 10px; font-weight: bold; }
    .card-bloco { border: 1px solid #ddd; border-radius: 6px; padding: 10px; background: #fff; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
  </style>
</head>
<body>
  <div class="quiz-container">
    <h1 style="text-align:center; margin-bottom: 30px;">Saúde Coletiva, APS e Vigilância Epidemiológica.</h1>
    <div class="card-bloco" id="quiz"></div>
    <button class="submit-btn" id="verifyAnswersBtn">Verificar Respostas</button>
    <button class="generate-questions-btn submit-btn" id="generateNewQuestionsBtn" style="display:none;">Gerar Novas Perguntas</button>
    <div class="results card-bloco" id="results"></div>
    <div id="statusMessage" style="text-align: center; margin-top: 10px; font-weight: bold; color: #007bff;"></div>
    <div class="error-diagnosis-section card-bloco" id="errorDiagnosis">
      <h2>Diagnóstico de Erros</h2>
      <p>Parece que você precisa revisar os seguintes assuntos:</p>
      <ul id="topicsToReview"></ul>
    </div>
    <div class="generated-questions-section card-bloco" id="generatedQuestionsSection" style="display:none;">
      <h2>Novas Perguntas Geradas</h2>
      <div id="newQuestionsContent"></div>
    </div>
  </div>

  <script>
    const quizContainer = document.getElementById("quiz");
    const resultsContainer = document.getElementById("results");
    const errorDiagnosisSection = document.getElementById("errorDiagnosis");
    const topicsToReviewList = document.getElementById("topicsToReview");
    const generateNewQuestionsBtn = document.getElementById("generateNewQuestionsBtn");
    const generatedQuestionsSection = document.getElementById("generatedQuestionsSection");
    const newQuestionsContent = document.getElementById("newQuestionsContent");
    const statusMessage = document.getElementById("statusMessage");

    let wrongQuestionIndices = [];
    let errorCountByTopic = {};
    let totalAnsweredQuestionsByTopic = {};
    let hasErrors = false;

    const questions = [     {         question: "Sobre o processo de territorialização na Atenção Básica, é correto afirmar que:",         options: [             "O território da equipe deve ser definido com base apenas na divisão geográfica do município.",             "A territorialização busca ampliar o acesso à alta complexidade hospitalar.",             "A responsabilidade da equipe é apenas sobre os pacientes que procuram a unidade de saúde.",             "O território deve ser definido considerando a vulnerabilidade social e o vínculo com a população.",             "Não é necessário mapear os serviços e equipamentos da região durante a territorialização."         ],         correctAnswer: "O território deve ser definido considerando a vulnerabilidade social e o vínculo com a população.",         comment: "A territorialização envolve mais do que delimitação geográfica: considera vínculos, acessos e grau de vulnerabilidade social da população.",         topic: "Territorialização na APS"     },     {         question: "O genograma é uma ferramenta importante na ESF, pois permite:",         options: [             "Avaliar as relações entre a família e os serviços comunitários externos.",             "Organizar o atendimento com base em queixas clínicas individuais.",             "Registrar apenas os diagnósticos de doenças crônicas.",             "Compreender a estrutura familiar e as relações afetivas ao longo do tempo.",             "Elaborar exclusivamente o plano medicamentoso do Projeto Terapêutico Singular."         ],         correctAnswer: "Compreender a estrutura familiar e as relações afetivas ao longo do tempo.",         comment: "O genograma é uma representação gráfica que mostra as relações familiares, composição e eventos importantes ao longo das gerações.",         topic: "Ferramentas de Abordagem Familiar"     },     {         question: "Sobre o Projeto Terapêutico Singular (PTS), assinale a alternativa correta:",         options: [             "O PTS deve ser construído exclusivamente pelo médico e pelo paciente.",             "O objetivo do PTS é otimizar o uso de medicamentos e exames complementares.",             "O PTS busca personalizar o cuidado por meio da elaboração coletiva com a equipe, o paciente e os cuidadores.",             "O PTS é aplicado apenas em pacientes com transtornos mentais severos.",             "O PTS é usado apenas em internações hospitalares prolongadas."         ],         correctAnswer: "O PTS busca personalizar o cuidado por meio da elaboração coletiva com a equipe, o paciente e os cuidadores.",         comment: "O Projeto Terapêutico Singular é construído de forma interdisciplinar e coletiva, focando na singularidade e autonomia do sujeito.",         topic: "Projeto Terapêutico Singular (PTS)"     },     {         question: "O conceito de determinantes sociais da saúde (DSS) refere-se a:",         options: [             "Fatores genéticos que causam doenças hereditárias.",             "Condições sociais e econômicas que influenciam a saúde e podem ser modificadas por políticas públicas.",             "Programas de rastreio genético populacional.",             "Critérios laboratoriais para diagnóstico de doenças infecciosas.",             "Exclusivamente ao acesso a serviços de saúde terciária."         ],         correctAnswer: "Condições sociais e econômicas que influenciam a saúde e podem ser modificadas por políticas públicas.",         comment: "Os DSS explicam como as condições de vida e trabalho impactam o processo saúde-doença e exigem ações intersetoriais.",         topic: "Determinantes Sociais da Saúde"     },     {         question: "Sobre a definição de caso em uma investigação de surto, é correto afirmar:",         options: [             "Deve conter apenas critérios clínicos para facilitar a inclusão de todos os casos.",             "É usada apenas para diagnóstico individual de pacientes em consultório.",             "Deve incluir critérios clínicos, laboratoriais e epidemiológicos, como tempo, lugar e pessoa.",             "Deve ser utilizada apenas após a conclusão da investigação.",             "Pode variar a cada paciente, conforme seu histórico individual."         ],         correctAnswer: "Deve incluir critérios clínicos, laboratoriais e epidemiológicos, como tempo, lugar e pessoa.",         comment: "Uma definição de caso padronizada (clínica, laboratorial e epidemiológica) é essencial para monitorar a dinâmica do surto.",         topic: "Investigação de Surtos"     },     {         question: "O ecomapa é uma ferramenta que permite à equipe da ESF:",         options: [             "Realizar o rastreio de doenças infectocontagiosas.",             "Planejar exclusivamente o tratamento medicamentoso de um paciente.",             "Visualizar as relações do núcleo familiar com instituições, serviços e redes de apoio da comunidade.",             "Avaliar apenas o histórico de doenças familiares.",             "Organizar o território com base no número de prontuários ativos."         ],         correctAnswer: "Visualizar as relações do núcleo familiar com instituições, serviços e redes de apoio da comunidade.",         comment: "O ecomapa foca nas conexões da família com o ambiente externo, revelando redes de apoio social, serviços e possíveis conflitos.",         topic: "Ferramentas de Abordagem Familiar"     },     {         question: "A vigilância epidemiológica é caracterizada por:",         options: [             "Realizar atendimento clínico individualizado.",             "Focar apenas em doenças genéticas e hereditárias.",             "Coletar, analisar e interpretar dados de saúde para controle e prevenção de doenças.",             "Monitorar exclusivamente doenças ocupacionais.",             "Elaborar apenas diagnósticos laboratoriais."         ],         correctAnswer: "Coletar, analisar e interpretar dados de saúde para controle e prevenção de doenças.",         comment: "Sua função principal é fornecer subsídios para o planejamento e execução de ações de controle e prevenção de agravos à saúde.",         topic: "Vigilância Epidemiológica"     },     {         question: "Um surto é caracterizado por:",         options: [             "A ocorrência de uma doença por um longo período, em várias regiões do país.",             "O aumento súbito do número de casos de uma doença em uma população específica, em um curto período.",             "A redução contínua dos casos de uma doença crônica.",             "A erradicação de uma doença em nível mundial.",             "A presença constante de uma doença em uma população."         ],         correctAnswer: "O aumento súbito do número de casos de uma doença em uma população específica, em um curto período.",         comment: "O surto ocorre quando há um excesso de casos em relação ao esperado em uma área geográfica restrita ou instituição.",         topic: "Epidemiologia de Agravos"     },     {         question: "A notificação compulsória de doenças é um instrumento de:",         options: [             "Controle financeiro da unidade de saúde.",             "Planejamento de cirurgias eletivas.",             "Vigilância em saúde para detecção precoce e resposta rápida a agravos.",             "Organização de escalas médicas.",             "Avaliação da performance de profissionais de saúde."         ],         correctAnswer: "Vigilância em saúde para detecção precoce e resposta rápida a agravos.",         comment: "A notificação permite a detecção oportuna de eventos que podem colocar a saúde pública em risco.",         topic: "Sistemas de Informação e Notificação"     },     {         question: "A territorialização deve considerar:",         options: [             "Apenas os critérios políticos e administrativos do município.",             "O número de consultas médicas por unidade de saúde.",             "As condições sociais, ambientais, econômicas e epidemiológicas da população.",             "O tempo de atuação da equipe de saúde na região.",             "A quantidade de médicos disponíveis por bairro."         ],         correctAnswer: "As condições sociais, ambientais, econômicas e epidemiológicas da população.",         comment: "Uma territorialização eficaz considera a complexidade multidimensional dos fatores que afetam a saúde da comunidade.",         topic: "Territorialização na APS"     },     {         question: "A Estratégia Saúde da Família (ESF) tem como base o princípio da:",         options: [             "Hospitalização precoce.",             "Atenção especializada.",             "Integralidade do cuidado e vínculo com a comunidade.",             "Alta complexidade assistencial.",             "Privatização dos serviços de saúde."         ],         correctAnswer: "Integralidade do cuidado e vínculo com a comunidade.",         comment: "O vínculo e a integralidade garantem um cuidado humanizado e contínuo, focado nas necessidades reais daquela população.",         topic: "Estratégia Saúde da Família"     },     {         question: "Um dos objetivos principais da APS é:",         options: [             "Aumentar a realização de cirurgias eletivas.",             "Oferecer cuidados de saúde próximos ao cotidiano das pessoas, com ações de promoção, prevenção, diagnóstico, tratamento e reabilitação.",             "Promover internações hospitalares imediatas.",             "Substituir serviços especializados por atendimentos em pronto-socorro.",             "Centralizar os atendimentos em grandes hospitais."         ],         correctAnswer: "Oferecer cuidados de saúde próximos ao cotidiano das pessoas, com ações de promoção, prevenção, diagnóstico, tratamento e reabilitação.",         comment: "A APS busca ser a porta de entrada preferencial e o centro da coordenação do cuidado no sistema de saúde.",         topic: "Princípios da Atenção Primária"     },     {         question: "No contexto da APS, o acolhimento significa:",         options: [             "Atender pacientes apenas por ordem de chegada.",             "Direcionar automaticamente todos os usuários para a consulta médica.",             "Oferecer escuta qualificada e humanizada, acolhendo as necessidades dos usuários de forma resolutiva.",             "Restringir o atendimento a usuários cadastrados.",             "Realizar triagem para encaminhamento hospitalar."         ],         correctAnswer: "Oferecer escuta qualificada e humanizada, acolhendo as necessidades dos usuários de forma resolutiva.",         comment: "O acolhimento não é apenas 'recepcionar', mas sim responsabilizar-se pela necessidade do outro de forma ética.",         topic: "Acolhimento e Humanização"     },     {         question: "A definição de caso para investigação de surtos permite:",         options: [             "A realização de diagnóstico individual preciso para cada paciente.",             "Identificar os casos que devem ser incluídos na investigação, com base em critérios padronizados.",             "A exclusão de casos suspeitos que não foram confirmados laboratorialmente.",             "A redução do tempo de atendimento clínico.",             "A substituição do tratamento medicamentoso por medidas epidemiológicas."         ],         correctAnswer: "Identificar os casos que devem ser incluídos na investigação, com base em critérios padronizados.",         comment: "Padronizar o que é 'caso' permite contar corretamente os doentes e entender a magnitude do evento sanitário.",         topic: "Investigação de Surtos"     },     {         question: "Sobre os instrumentos de análise do território utilizados na APS, é correto afirmar:",         options: [             "O mapa falado não tem validade científica e não deve ser usado.",             "O genograma é usado para analisar as relações sociais extrafamiliares.",             "O ecomapa complementa o genograma ao mostrar conexões do núcleo familiar com recursos externos.",             "A territorialização é um processo desnecessário na prática da ESF.",             "O território deve ser analisado apenas uma vez, no início do trabalho da equipe."         ],         correctAnswer: "O ecomapa complementa o genograma ao mostrar conexões do núcleo familiar com recursos externos.",         comment: "Enquanto o genograma olha 'para dentro' da família (genética/afetos), o ecomapa olha 'para fora' (trabalho, igreja, lazer, saúde).",         topic: "Ferramentas de Abordagem Familiar"     },     {         question: "Sobre os princípios da Atenção Primária à Saúde (APS), é correto afirmar que:",         options: [             "A equidade implica oferecer os mesmos serviços para todos os usuários, independentemente de sua condição social.",             "A universalidade garante que apenas os residentes legais tenham acesso aos serviços de saúde.",             "A integralidade pressupõe a oferta de ações promocionais, preventivas, curativas e reabilitadoras, de forma articulada e contínua.",             "A APS deve priorizar procedimentos de alta complexidade para ampliar a resolutividade.",             "O vínculo entre profissional e usuário deve ser evitado para manter a imparcialidade técnica."         ],         correctAnswer: "A integralidade pressupõe a oferta de ações promocionais, preventivas, curativas e reabilitadoras, de forma articulada e contínua.",         comment: "A integralidade busca atender às diversas necessidades de saúde da população de forma holística e ininterrupta.",         topic: "Princípios do SUS e da APS"     },     {         question: "O acolhimento como diretriz na Atenção Básica visa:",         options: [             "Estabelecer um espaço de escuta qualificada, responsabilização e humanização do atendimento ao usuário.",             "Realizar apenas a triagem clínica dos pacientes mais graves.",             "Direcionar os usuários exclusivamente ao atendimento médico.",             "Restringir o acesso de usuários não cadastrados na unidade.",             "Priorizar o atendimento por ordem de chegada, independentemente da queixa."         ],         correctAnswer: "Estabelecer um espaço de escuta qualificada, responsabilização e humanização do atendimento ao usuário.",         comment: "Um acolhimento eficaz fortalece o vínculo e aumenta a confiança da comunidade no serviço de saúde.",         topic: "Acolhimento e Humanização"     },     {         question: "Na investigação de um surto de Doença Diarreica Aguda (DDA) em uma comunidade atendida pela ESF, a primeira medida a ser tomada é:",         options: [             "Iniciar o tratamento medicamentoso em todos os casos suspeitos.",             "Confirmar a existência do surto por meio da comparação com o número esperado de casos na população afetada.",             "Realizar exames laboratoriais em toda a população da área afetada.",             "Notificar apenas os casos graves aos órgãos superiores.",             "Encaminhar todos os pacientes para hospitais de referência."         ],         correctAnswer: "Confirmar a existência do surto por meio da comparação com o número esperado de casos na população afetada.",         comment: "A confirmação técnica de que o número de casos ultrapassou o limiar endêmico é o passo inicial obrigatório.",         topic: "Investigação de Surtos"     },     {         question: "Sobre o papel da equipe de Saúde da Família (ESF) na vigilância em saúde, assinale a alternativa correta:",         options: [             "A vigilância é uma responsabilidade exclusiva das secretarias estaduais de saúde.",             "A eSF deve integrar ações de vigilância epidemiológica, sanitária e ambiental no cuidado cotidiano.",             "A equipe deve notificar apenas agravos relacionados ao trabalho.",             "A vigilância deve ser feita apenas após solicitação da gestão municipal.",             "A vigilância é um setor separado da atenção primária, sem articulação com os serviços da UBS."         ],         correctAnswer: "A eSF deve integrar ações de vigilância epidemiológica, sanitária e ambiental no cuidado cotidiano.",         comment: "A equipe de saúde da família está na ponta, sendo fundamental para identificar riscos ambientais e sanitários precocemente.",         topic: "Vigilância em Saúde"     },     {         question: "O mapa falado, utilizado na territorialização, consiste em:",         options: [             "Um levantamento estatístico realizado por georreferenciamento via satélite.",             "Um modelo padronizado de mapeamento oferecido pelo Ministério da Saúde.",             "Um recurso qualitativo em que os profissionais constroem coletivamente o conhecimento do território a partir das falas e vivências da população.",             "Um instrumento de triagem populacional feito a partir do genograma.",             "Um relatório técnico-cientico utilizado apenas em auditorias da gestão municipal."         ],         correctAnswer: "Um recurso qualitativo em que os profissionais constroem coletivamente o conhecimento do território a partir das falas e vivências da população.",         comment: "O mapa falado é uma construção social do espaço, valorizando a subjetividade e a história da comunidade local.",         topic: "Territorialização na APS"     } ];

    function buildQuiz() {
      const output = [];
      questions.forEach((currentQuestion, questionNumber) => {
        const options = [];
        for (let i = 0; i < currentQuestion.options.length; i++) {
          options.push(`<label class="option" data-question="${questionNumber}" data-value="${currentQuestion.options[i]}"><img src="tesouras.png" class="scissor-icon" onclick="event.stopPropagation(); this.parentNode.classList.toggle('struck-through');">${currentQuestion.options[i]}</label>`);
        }
        output.push(`<div class="card" id="question-${questionNumber}" data-topic="${currentQuestion.topic}"><div class="question">${currentQuestion.question}</div><div class="options">${options.join("")}</div><div class="comment" id="comment-${questionNumber}"></div></div>`);
      });
      quizContainer.innerHTML = output.join("");
    }

    function showResults() {
      // Lógica de resultados... (simplificada para o exemplo)
    }

    document.addEventListener("click", function (event) {
        const clickedElement = event.target;
        const optionElement = clickedElement.closest('.option');
        if (optionElement) {
            if (clickedElement.classList.contains("scissor-icon")) {
                event.stopPropagation();
                optionElement.classList.toggle("struck-through");
            } else {
                const parentCard = optionElement.closest('.card');
                const currentQuestionOptions = parentCard.querySelectorAll('.option');
                currentQuestionOptions.forEach(opt => opt.classList.remove("selected"));
                optionElement.classList.add("selected");
            }
        }
    });

    generateNewQuestionsBtn.addEventListener("click", async function() {
        statusMessage.textContent = '⏳ Gerando novas perguntas...';
        generateNewQuestionsBtn.disabled = true;
        const topics = Object.keys(errorCountByTopic).filter(topic => (errorCountByTopic[topic] || 0) > 0);
        const topicsToSend = topics.length > 0 ? topics : ["fisiologia celular", "biologia"];
        try {
            const response = await fetch('https://www.quizia.xyz/quiz', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ topicos: topicsToSend }),
            });
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const data = await response.json();
            newQuestionsContent.innerHTML = '';
            if (data && data.html) {
                newQuestionsContent.innerHTML = data.html.replace(/```html|```/g, '');
                newQuestionsContent.querySelectorAll('.card').forEach((card) => {
                    const questionElement = card.querySelector('p');
                    if (questionElement && !questionElement.classList.contains('question')) questionElement.classList.add('question');
                    card.querySelectorAll('label').forEach((label) => {
                        const radioInput = label.querySelector('input[type="radio"]');
                        if (radioInput) {
                            if (radioInput.hasAttribute('data-answer')) label.setAttribute('data-answer', radioInput.getAttribute('data-answer'));
                            radioInput.remove();
                        }
                        if (!label.classList.contains('option')) label.classList.add('option');
                        if (!label.dataset.value) label.dataset.value = label.textContent.trim();
                        if (!label.querySelector('.scissor-icon')) {
                            const scissorIcon = document.createElement('img');
                            scissorIcon.src = 'tesouras.png';
                            scissorIcon.className = 'scissor-icon';
                            scissorIcon.onclick = function(e) { e.stopPropagation(); label.classList.toggle('struck-through'); };
                            label.insertBefore(scissorIcon, label.firstChild);
                        }
                    });
                });
            }
            generatedQuestionsSection.style.display = 'block';
            generatedQuestionsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            statusMessage.textContent = '✅ Perguntas geradas com sucesso!';
            setTimeout(() => { statusMessage.textContent = '' }, 3000);
        } catch (error) {
            console.error('Erro:', error);
            statusMessage.textContent = '❌ Erro: ' + error.message;
        } finally {
            generateNewQuestionsBtn.disabled = false;
        }
    });

    buildQuiz();
    document.getElementById("verifyAnswersBtn").addEventListener("click", showResults);
  </script>
  <script src="conexao_firebase.js"></script>
  <script src="navegacao.js"></script>
  <script type="module" src="padrao_simulado.js"></script>
</body>
</html>
