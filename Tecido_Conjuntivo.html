<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Simulado Tecido Conjuntivo </title>
  <style>
    body { font-family: sans-serif; margin: 0; padding: 20px; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; background-color: #f4f4f4; }
    .quiz-container { max-width: 800px; width: 100%; }
    h1 { color: #333; text-align: center; margin-bottom: 30px; }
    .card { background-color: white; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }
    .question { font-weight: bold; margin-bottom: 10px; color: #333; }
    .options { margin-top: 15px; }
    .option, label.option, label, #newQuestionsContent label { display: flex; align-items: center; margin-bottom: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; cursor: pointer; transition: background-color 0.2s ease; position: relative; }
    .option input[type="radio"], label input[type="radio"], #newQuestionsContent input[type="radio"], #newQuestionsContent label input[type="radio"] { display: none !important; visibility: hidden !important; opacity: 0 !important; position: absolute !important; left: -9999px !important; }
    .option:hover, label.option:hover, label:hover, #newQuestionsContent label:hover { background-color: #e9e9e9; }
    .option.selected, label.option.selected, label.selected, #newQuestionsContent label.selected { background-color: #d1e7dd; border-color: #28a745; }
    .option.correct, label.option.correct, label.correct, #newQuestionsContent label.correct { background-color: #d4edda; border-color: #28a745; }
    .option.incorrect, label.option.incorrect, label.incorrect, #newQuestionsContent label.incorrect { background-color: #f8d7da; border-color: #dc3545; }
    .submit-btn { display: block; width: 100%; padding: 15px; background-color: #007bff; color: white; border: none; border-radius: 5px; font-size: 18px; cursor: pointer; transition: background-color 0.3s ease; margin-top: 30px; }
    .submit-btn:hover { background-color: #0056b3; }
    .results { text-align: center; margin-top: 30px; font-size: 20px; font-weight: bold; color: #333; }
    .scissor-icon { margin-right: 10px; width: 20px; height: 20px; opacity: 0.5; cursor: pointer; }
    .struck-through { text-decoration: line-through; color: #888; }
    .comment { margin-top: 10px; padding: 10px; background-color: #f0f0f0; border-left: 4px solid #007bff; font-style: italic; color: #555; display: none; }
    .comment.show { display: block; }
    .error-diagnosis-section { margin-top: 50px; padding: 30px; background-color: #ffe0b2; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.15); display: none; text-align: center; font-size: 1.1em; color: #333; }
    .error-diagnosis-section h2 { color: #e65100; margin-bottom: 20px; font-size: 1.8em; }
    .error-diagnosis-section ul { list-style: none; padding: 0; margin: 0; }
    .error-diagnosis-section li { background-color: #ff9800; color: white; padding: 8px 15px; margin: 8px 0; border-radius: 5px; display: inline-block; margin-right: 10px; font-weight: bold; }
    .card-bloco { border: 1px solid #ddd; border-radius: 6px; padding: 10px; background: #fff; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
  </style>
</head>
<body>
  <div class="quiz-container">
    <h1 style="text-align:center; margin-bottom: 30px;">Simulado Tecido Conjuntivo </h1>
    <div class="card-bloco" id="quiz"></div>
    <button class="submit-btn" id="verifyAnswersBtn">Verificar Respostas</button>
    <button class="generate-questions-btn submit-btn" id="generateNewQuestionsBtn" style="display:none;">Gerar Novas Perguntas</button>
    <div class="results card-bloco" id="results"></div>
    <div id="statusMessage" style="text-align: center; margin-top: 10px; font-weight: bold; color: #007bff;"></div>
    <div class="error-diagnosis-section card-bloco" id="errorDiagnosis">
      <h2>Diagnóstico de Erros</h2>
      <p>Parece que você precisa revisar os seguintes assuntos:</p>
      <ul id="topicsToReview"></ul>
    </div>
    <div class="generated-questions-section card-bloco" id="generatedQuestionsSection" style="display:none;">
      <h2>Novas Perguntas Geradas</h2>
      <div id="newQuestionsContent"></div>
    </div>
  </div>

  <script>
    const quizContainer = document.getElementById("quiz");
    const resultsContainer = document.getElementById("results");
    const errorDiagnosisSection = document.getElementById("errorDiagnosis");
    const topicsToReviewList = document.getElementById("topicsToReview");
    const generateNewQuestionsBtn = document.getElementById("generateNewQuestionsBtn");
    const generatedQuestionsSection = document.getElementById("generatedQuestionsSection");
    const newQuestionsContent = document.getElementById("newQuestionsContent");
    const statusMessage = document.getElementById("statusMessage");

    let wrongQuestionIndices = [];
    let errorCountByTopic = {};
    let totalAnsweredQuestionsByTopic = {};
    let hasErrors = false;

    const questions = [     {         question: "1) Sobre as funções do tecido conjuntivo, assinale a alternativa incorreta:",         options: [             "Nutrição de outros tecidos.",             "Sustentação.",             "Absorção de impactos.",             "Revestimento.",             "Armazenamento de energia."         ],         correctAnswer: "Revestimento.",         comment: "A função de revestimento é característica do Tecido Epitelial. O tecido conjuntivo atua no preenchimento, sustentação, transporte de nutrientes (sangue) e reserva energética (adiposo).",         topic: "Funções do Tecido Conjuntivo"     },     {         question: "2) O tecido conjuntivo é constituído de abundante matriz extracelular. Sobre essa estrutura, marque a alternativa errada:",         options: [             "Em todos os tipos de tecido conjuntivo a matriz extracelular apresenta a mesma quantidade de fibras e de substância fundamental.",             "As fibras colágenas não se coram pelas colorações de rotina, sendo necessário utilizar corantes específicos para corar o colágeno, nos preparados histológicos.",             "A substância fundamental é constituída por moléculas que tridimensionalmente lembram uma escova de lavar tubos, onde a haste representa os proteoglicanos e as cerdas são os glicosaminoglicanos.",             "No processo natural de envelhecimento ocorre a redução da síntese de fibras colágenas e elásticas.",             "É um tecido muito vascularizado, que fornece oxigênio e nutrientes para o tecido epitelial de revestimento que é avascular."         ],         correctAnswer: "Em todos os tipos de tecido conjuntivo a matriz extracelular apresenta a mesma quantidade de fibras e de substância fundamental.",         comment: "A proporção entre fibras e substância fundamental varia conforme o tipo: no frouxo há equilíbrio, no denso predominam as fibras e no mucoso predomina a substância fundamental.",         topic: "Matriz Extracelular (MEC)"     },     {         question: "3) As fibras de tecido conjuntivo estão presentes em quantidades variadas. Sobre essas fibras, marque a alternativa incorreta:",         options: [             "As fibras elásticas são constituídas da proteína elastina, são fibras mais finas que as colágenas.",             "As fibras colágenas são constituídas pelas moléculas de tropocolágeno, que por sua vez são constituídas de aminoácidos.",             "As fibras reticulares são constituídas de colágeno tipo III, que se cora pela prata, sendo também chamadas de fibras argirófilas.",             "As fibras colágenas são bem finas, e estão organizadas como uma rede que serve de arcabouço de sustentação para alguns órgãos.",             "As fibras colágenas estão presentes nos tendões, derme e na cápsula que reveste alguns órgãos."         ],         correctAnswer: "As fibras colágenas são bem finas, e estão organizadas como uma rede que serve de arcabouço de sustentação para alguns órgãos.",         comment: "A descrição de 'fibras finas em rede para arcabouço' refere-se às fibras reticulares (colágeno tipo III). As fibras colágenas (tipo I) são mais espessas e formam feixes resistentes.",         topic: "Fibras do Tecido Conjuntivo"     },     {         question: "4) As fibras e a substância fundamental do tecido conjuntivo são produzidas pela seguinte célula:",         options: [             "Macrófago",             "Linfócito",             "Fibroblasto",             "Monócito",             "Mastócito"         ],         correctAnswer: "Fibroblasto",         comment: "O fibroblasto é a célula principal do tecido conjuntivo, responsável pela síntese de colágeno, elastina, glicosaminoglicanos e proteoglicanos da matriz.",         topic: "Células do Tecido Conjuntivo"     },     {         question: "5) Sobre o processo alérgico, não podemos afirmar que:",         options: [             "Ocorre a liberação pelas células de um potente mediador químico chamado histamina.",             "As células presentes no tecido conjuntivo envolvidas no processo alérgico são os mastócitos e macrófagos.",             "A histamina promove alguns eventos como: vermelhidão, dor, edema e calor observados no processo alérgico.",             "O antígeno (alérgeno) se liga a um anticorpo (IgE), que se liga ao receptor presente na membrana da célula, promovendo a liberação dos grânulos de histamina.",             "Os mastócitos apresentam grânulos metacromáticos no citoplasma, núcleo esférico e central."         ],         correctAnswer: "As células presentes no tecido conjuntivo envolvidas no processo alérgico são os mastócitos e macrófagos.",         comment: "Embora os macrófagos atuem na inflamação, as células centrais da desgranulação alérgica imediata via IgE são os mastócitos. Os macrófagos são focados em fagocitose.",         topic: "Imunologia e Inflamação"     },     {         question: "6) Existem dois tipos de tecido conjuntivo denso: o tipo modelado e o não modelado. A principal característica que diferencia esses dois tipos é:",         options: [             "A disposição e direção das fibras.",             "A quantidade de matriz extracelular.",             "A quantidade de fibras.",             "O tipo de fibra presente no tecido.",             "A célula que sintetiza."         ],         correctAnswer: "A disposição e direção das fibras.",         comment: "No denso modelado, os feixes de colágeno são paralelos (resistência unidirecional, ex: tendões). No não modelado, as fibras são aleatórias (resistência multidirecional, ex: derme).",         topic: "Classificação do Tecido Conjuntivo"     },     {         question: "7) Sobre os diversos tipos de tecido conjuntivo, é correto afirmar que:",         options: [             "O tecido conjuntivo reticular é constituído pelas fibras reticulares, constituídas de colágeno do tipo I.",             "O tecido conjuntivo elástico apresenta uma estrutura semelhante a uma rede ou esponja, que estão presentes no estroma dos órgãos hematopoiético...",             "O tecido conjuntivo frouxo tem aspecto gelatinoso, com predominância de substância fundamental, é o principal constituinte do cordão umbilical.",             "O tecido conjuntivo reticular é formado por fibras elásticas grossas, por fibras colágenas finas e por fibroblastos.",             "O tecido conjuntivo frouxo apresenta as células, fibras e a substância fundamental na mesma proporção."         ],         correctAnswer: "O tecido conjuntivo frouxo apresenta as células, fibras e a substância fundamental na mesma proporção.",         comment: "O tecido conjuntivo frouxo é caracterizado por não ter predominância de nenhum componente, sendo flexível e bem vascularizado.",         topic: "Tipos de Tecido Conjuntivo"     },     {         question: "8) Sobre os diversos tipos de tecido conjuntivo, não podemos afirmar que:",         options: [             "O tecido conjuntivo encontrado na lâmina própria é do tipo frouxo e muito vascularizado.",             "O Tecido conjuntivo encontrado na lâmina própria apresenta abundante quantidade de fibras colágenas e pouca substância fundamental.",             "O tecido conjuntivo mucoso também chamado de Geléia de Wharton, têm grande quantidade de substância fundamental.",             "O tecido conjuntivo denso, está dividido em modelado e não modelado.",             "O tecido conjuntivo denso modelado está presente nos tendões."         ],         correctAnswer: "O Tecido conjuntivo encontrado na lâmina própria apresenta abundante quantidade de fibras colágenas e pouca substância fundamental.",         comment: "A lâmina própria (abaixo de epitélios) é tipicamente tecido conjuntivo frouxo, possuindo poucas fibras e muita substância fundamental para permitir a difusão de nutrientes.",         topic: "Localização Histológica"     },     {         question: "9) Com relação às células do tecido conjuntivo marque a alternativa falsa:",         options: [             "Os macrófagos são células com intenso poder de fagocitose e que fazem parte do sistema fagocítário mononuclear.",             "Os plasmócitos apresentam o núcleo esférico com cromatina em grumos, que se alternam com áreas claras, dando ao núcleo, aspecto de roda de carroça.",             "Adipócito ou célula adiposa é especializada no armazenamento de gorduras.",             "Os mastócitos são as células derivadas dos linfócitos B e que produzem os anticorpos.",             "Os leucócitos são células presentes no sangue, que vão para o tecido conjuntivo quando são recrutadas para realizar a defesa do organismo."         ],         correctAnswer: "Os mastócitos são as células derivadas dos linfócitos B e que produzem os anticorpos.",         comment: "Quem deriva dos linfócitos B e produz anticorpos são os plasmócitos. Os mastócitos originam-se de células progenitoras da medula óssea.",         topic: "Células do Tecido Conjuntivo"     },     {         question: "10) Sobre o tecido conjuntivo propriamente dito, assinale a alternativa incorreta:",         options: [             "O tecido conjuntivo propriamente dito denso pode ser modelado ou não modelado.",             "O tecido conjuntivo denso oferece maior resistência e proteção aos tecidos que o tecido conjuntivo frouxo.",             "Quando as fibras colágenas desse tecido são organizadas em feixes sem uma orientação definida, o tecido chama-se denso não modelado.",             "No tecido conjuntivo frouxo há a predominância de substância fundamental, com relação aos outros elementos.",             "Esse tecido é constituído por fibras colágenas do tipo I."         ],         correctAnswer: "No tecido conjuntivo frouxo há a predominância de substância fundamental, com relação aos outros elementos.",         comment: "No tecido conjuntivo frouxo, não há predominância absoluta; há equilíbrio. A predominância de substância fundamental é marca do tecido conjuntivo mucoso.",         topic: "Propriedades do Conjuntivo"     } ];

    function buildQuiz() {
      const output = [];
      questions.forEach((currentQuestion, questionNumber) => {
        const options = [];
        for (let i = 0; i < currentQuestion.options.length; i++) {
          options.push(`<label class="option" data-question="${questionNumber}" data-value="${currentQuestion.options[i]}"><img src="tesouras.png" class="scissor-icon" onclick="event.stopPropagation(); this.parentNode.classList.toggle('struck-through');">${currentQuestion.options[i]}</label>`);
        }
        output.push(`<div class="card" id="question-${questionNumber}" data-topic="${currentQuestion.topic}"><div class="question">${currentQuestion.question}</div><div class="options">${options.join("")}</div><div class="comment" id="comment-${questionNumber}"></div></div>`);
      });
      quizContainer.innerHTML = output.join("");
    }

    function showResults() {
      // Lógica de resultados... (simplificada para o exemplo)
    }

    document.addEventListener("click", function (event) {
        const clickedElement = event.target;
        const optionElement = clickedElement.closest('.option');
        if (optionElement) {
            if (clickedElement.classList.contains("scissor-icon")) {
                event.stopPropagation();
                optionElement.classList.toggle("struck-through");
            } else {
                const parentCard = optionElement.closest('.card');
                const currentQuestionOptions = parentCard.querySelectorAll('.option');
                currentQuestionOptions.forEach(opt => opt.classList.remove("selected"));
                optionElement.classList.add("selected");
            }
        }
    });

    generateNewQuestionsBtn.addEventListener("click", async function() {
        statusMessage.textContent = '⏳ Gerando novas perguntas...';
        generateNewQuestionsBtn.disabled = true;
        const topics = Object.keys(errorCountByTopic).filter(topic => (errorCountByTopic[topic] || 0) > 0);
        const topicsToSend = topics.length > 0 ? topics : ["fisiologia celular", "biologia"];
        try {
            const response = await fetch('https://www.quizia.xyz/quiz', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ topicos: topicsToSend }),
            });
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const data = await response.json();
            newQuestionsContent.innerHTML = '';
            if (data && data.html) {
                newQuestionsContent.innerHTML = data.html.replace(/```html|```/g, '');
                newQuestionsContent.querySelectorAll('.card').forEach((card) => {
                    const questionElement = card.querySelector('p');
                    if (questionElement && !questionElement.classList.contains('question')) questionElement.classList.add('question');
                    card.querySelectorAll('label').forEach((label) => {
                        const radioInput = label.querySelector('input[type="radio"]');
                        if (radioInput) {
                            if (radioInput.hasAttribute('data-answer')) label.setAttribute('data-answer', radioInput.getAttribute('data-answer'));
                            radioInput.remove();
                        }
                        if (!label.classList.contains('option')) label.classList.add('option');
                        if (!label.dataset.value) label.dataset.value = label.textContent.trim();
                        if (!label.querySelector('.scissor-icon')) {
                            const scissorIcon = document.createElement('img');
                            scissorIcon.src = 'tesouras.png';
                            scissorIcon.className = 'scissor-icon';
                            scissorIcon.onclick = function(e) { e.stopPropagation(); label.classList.toggle('struck-through'); };
                            label.insertBefore(scissorIcon, label.firstChild);
                        }
                    });
                });
            }
            generatedQuestionsSection.style.display = 'block';
            generatedQuestionsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            statusMessage.textContent = '✅ Perguntas geradas com sucesso!';
            setTimeout(() => { statusMessage.textContent = '' }, 3000);
        } catch (error) {
            console.error('Erro:', error);
            statusMessage.textContent = '❌ Erro: ' + error.message;
        } finally {
            generateNewQuestionsBtn.disabled = false;
        }
    });

    buildQuiz();
    document.getElementById("verifyAnswersBtn").addEventListener("click", showResults);
  </script>
  <script src="conexao_firebase.js"></script>
  <script src="navegacao.js"></script>
  <script type="module" src="padrao_simulado.js"></script>
</body>
</html>
