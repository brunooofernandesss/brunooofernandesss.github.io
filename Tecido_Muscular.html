<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Simulado de Tecido Muscular </title>
  <style>
    body { font-family: sans-serif; margin: 0; padding: 20px; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; background-color: #f4f4f4; }
    .quiz-container { max-width: 800px; width: 100%; }
    h1 { color: #333; text-align: center; margin-bottom: 30px; }
    .card { background-color: white; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }
    .question { font-weight: bold; margin-bottom: 10px; color: #333; }
    .options { margin-top: 15px; }
    .option, label.option, label, #newQuestionsContent label { display: flex; align-items: center; margin-bottom: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; cursor: pointer; transition: background-color 0.2s ease; position: relative; }
    .option input[type="radio"], label input[type="radio"], #newQuestionsContent input[type="radio"], #newQuestionsContent label input[type="radio"] { display: none !important; visibility: hidden !important; opacity: 0 !important; position: absolute !important; left: -9999px !important; }
    .option:hover, label.option:hover, label:hover, #newQuestionsContent label:hover { background-color: #e9e9e9; }
    .option.selected, label.option.selected, label.selected, #newQuestionsContent label.selected { background-color: #d1e7dd; border-color: #28a745; }
    .option.correct, label.option.correct, label.correct, #newQuestionsContent label.correct { background-color: #d4edda; border-color: #28a745; }
    .option.incorrect, label.option.incorrect, label.incorrect, #newQuestionsContent label.incorrect { background-color: #f8d7da; border-color: #dc3545; }
    .submit-btn { display: block; width: 100%; padding: 15px; background-color: #007bff; color: white; border: none; border-radius: 5px; font-size: 18px; cursor: pointer; transition: background-color 0.3s ease; margin-top: 30px; }
    .submit-btn:hover { background-color: #0056b3; }
    .results { text-align: center; margin-top: 30px; font-size: 20px; font-weight: bold; color: #333; }
    .scissor-icon { margin-right: 10px; width: 20px; height: 20px; opacity: 0.5; cursor: pointer; }
    .struck-through { text-decoration: line-through; color: #888; }
    .comment { margin-top: 10px; padding: 10px; background-color: #f0f0f0; border-left: 4px solid #007bff; font-style: italic; color: #555; display: none; }
    .comment.show { display: block; }
    .error-diagnosis-section { margin-top: 50px; padding: 30px; background-color: #ffe0b2; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.15); display: none; text-align: center; font-size: 1.1em; color: #333; }
    .error-diagnosis-section h2 { color: #e65100; margin-bottom: 20px; font-size: 1.8em; }
    .error-diagnosis-section ul { list-style: none; padding: 0; margin: 0; }
    .error-diagnosis-section li { background-color: #ff9800; color: white; padding: 8px 15px; margin: 8px 0; border-radius: 5px; display: inline-block; margin-right: 10px; font-weight: bold; }
    .card-bloco { border: 1px solid #ddd; border-radius: 6px; padding: 10px; background: #fff; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
  </style>
</head>
<body>
  <div class="quiz-container">
    <h1 style="text-align:center; margin-bottom: 30px;">Simulado de Tecido Muscular </h1>
    <div class="card-bloco" id="quiz"></div>
    <button class="submit-btn" id="verifyAnswersBtn">Verificar Respostas</button>
    <button class="generate-questions-btn submit-btn" id="generateNewQuestionsBtn" style="display:none;">Gerar Novas Perguntas</button>
    <div class="results card-bloco" id="results"></div>
    <div id="statusMessage" style="text-align: center; margin-top: 10px; font-weight: bold; color: #007bff;"></div>
    <div class="error-diagnosis-section card-bloco" id="errorDiagnosis">
      <h2>Diagnóstico de Erros</h2>
      <p>Parece que você precisa revisar os seguintes assuntos:</p>
      <ul id="topicsToReview"></ul>
    </div>
    <div class="generated-questions-section card-bloco" id="generatedQuestionsSection" style="display:none;">
      <h2>Novas Perguntas Geradas</h2>
      <div id="newQuestionsContent"></div>
    </div>
  </div>

  <script>
    const quizContainer = document.getElementById("quiz");
    const resultsContainer = document.getElementById("results");
    const errorDiagnosisSection = document.getElementById("errorDiagnosis");
    const topicsToReviewList = document.getElementById("topicsToReview");
    const generateNewQuestionsBtn = document.getElementById("generateNewQuestionsBtn");
    const generatedQuestionsSection = document.getElementById("generatedQuestionsSection");
    const newQuestionsContent = document.getElementById("newQuestionsContent");
    const statusMessage = document.getElementById("statusMessage");

    let wrongQuestionIndices = [];
    let errorCountByTopic = {};
    let totalAnsweredQuestionsByTopic = {};
    let hasErrors = false;

    const questions = [     {         question: "Qual o nome das proteínas relacionadas à contração muscular?",         options: [             "Actina e melanina.",             "Quitina e prolactina.",             "Actina e miosina.",             "Quitina e miosina.",             "Actina e quitina.",         ],         correctAnswer: "Actina e miosina.",         comment: "A actina (filamento fino) e a miosina (filamento grosso) são as proteínas motoras que deslizam entre si para promover o encurtamento do sarcômero e a contração muscular.",         topic: "Proteínas Contráteis"     },     {         question: "Julgue se as afirmativas são verdadeiras ou falsas e marque a alternativa correta.\nI. (V) O músculo estriado cardíaco também é conhecido como miocárdio.\nII. (V) O músculo estriado esquelético é formado por feixes de células cilíndricas muito longas e multinucleadas...\nIII. (V) O músculo liso é formado por aglomerados de células fusiformes que não possuem estrias transversais.\nIV. (F) Nos casos de infarto do miocárdio as fibras musculares cardíacas que permanecem viáveis entram em mitose e reparam o tecido.",         options: ["F, V, F, F", "V, V, F, V", "V, F, V, F", "F, F, F, V", "V, V, V, F"],         correctAnswer: "V, V, V, F",         comment: "As células musculares cardíacas não possuem capacidade regenerativa por mitose; após um infarto, o tecido morto é substituído por uma cicatriz de tecido conjuntivo (fibrose).",         topic: "Características Gerais dos Tecidos Musculares"     },     {         question: "A respeito dos discos intercalares, assinale a alternativa errada:",         options: [             "São estruturas encontradas exclusivamente no músculo estriado cardíaco.",             "São estruturas encontradas nos músculos estriados esquelético e cardíaco.",             "São complexos juncionais encontrados na célula muscular estriada cardíaca, que atuam tanto na adesão quanto na comunicação dessas células.",             "São linhas transversais fortemente coráveis que aparecem em intervalos irregulares ao longo da célula muscular cardíaca.",             "NDA.",         ],         correctAnswer: "São estruturas encontradas nos músculos estriados esquelético e cardíaco.",         comment: "Os discos intercalares são características exclusivas do músculo cardíaco, contendo desmossomos para adesão e junções comunicantes para a propagação rápida do impulso elétrico.",         topic: "Músculo Estriado Cardíaco"     },     {         question: "Relacione o tipo de músculo com a atividade que ele exerce.\n1. Músculo Liso\n2. Músculo Estriado Esquelético\n3. Músculo Estriado Cardíaco.\n( ) Contração forte, rápida descontínua e voluntária.\n( ) Contração fraca, lenta e involuntária.\n( ) Contração forte, rápida, continua e involuntária.\nA ordem correta é:",         options: ["1, 2, 3", "2, 3, 1", "2, 1, 3", "3, 2, 1", "3, 1, 2"],         correctAnswer: "2, 1, 3",         comment: "O músculo esquelético é voluntário (2), o liso é lento e involuntário (1) e o cardíaco é rítmico, contínuo e involuntário (3).",         topic: "Fisiologia da Contração"     },     {         question: "As fibras musculares estão organizadas em grupos de feixes, sendo o conjunto de feixes envolvidos por tecido conjuntivo denso. De dentro para fora observamos as respectivas camadas de tecido conjuntivo no tecido muscular:",         options: [             "Perimísio, endomísio, epimísio",             "Endomísio, epimísio, perimísio",             "Epimísio, perimísio, endomísio",             "Epimísio, endomísio, perimísio",             "Endomísio, perimísio, epimísio",         ],         correctAnswer: "Endomísio, perimísio, epimísio",         comment: "O endomísio envolve cada fibra, o perimísio envolve feixes de fibras (fascículos) e o epimísio envolve o músculo como um todo.",         topic: "Organização do Tecido Conjuntivo no Músculo"     },     {         question: "Ao microscópio de polarização, a faixa escura é anisotrópica e, por isso, recebeu o nome de ______, enquanto a faixa clara, ou ______, é isotrópica. No centro de cada ______ nota-se uma linha transversal escura, a ______.\nA alternativa que preenche corretamente é:",         options: [             "Banda A, banda I, banda A, linha Z.",             "Banda I, banda A, banda I, linha Z.",             "Linha Z, banda A, banda A, banda I.",             "Linha Z, banda I, banda I, banda A.",             "Banda A, banda I, banda I, Linha Z.",         ],         correctAnswer: "Banda A, banda I, banda I, Linha Z.",         comment: "A Banda A (Anisotrópica) é escura, a Banda I (Isotrópica) é clara e possui a Linha Z em seu centro, que delimita os sarcômeros.",         topic: "Morfologia do Sarcômero"     },     {         question: "As miofibrilas do músculo estriado contêm quatro proteínas principais:",         options: [             "Actina, miosina, tropomiosina e troponina.",             "Actina, miosina, queratina e troponina.",             "Actina, miosina, tropomiosina e queratina.",             "Actina, miosina, queratina e albimina.",             "Actina, miosina, queratina e colágeno.",         ],         correctAnswer: "Actina, miosina, tropomiosina e troponina.",         comment: "Além da actina e miosina, a tropomiosina e a troponina são proteínas reguladoras essenciais que controlam a interação entre os filamentos na presença de cálcio.",         topic: "Proteínas Contráteis e Reguladoras"     },     {         question: "Em relação ao sistema de túbulos transversais, marque a alternativa errada.",         options: [             "É responsável pela contração uniforme de cada fibra muscular esquelética.",             "Este sistema é constituído por uma rede de invaginações tubulares da membrana plasmática da fibra muscular, cujos ramos vão envolver as junções das bandas A e I de cada sarcômero.",             "O complexo formado de um túbulo T e duas expansões do retículo sarcoplasmático é conhecido como tríade.",             "A despolarização dos túbulos T, derivados do sarcolema, é transmitida ao retículo sarcoplasmático.",             "NDA.",         ],         correctAnswer: "NDA.",         comment: "Todas as alternativas anteriores estão corretas. O sistema T é crucial para levar o potencial de ação para o interior da fibra de forma rápida.",         topic: "Sistema de Túbulos T e Tríades"     },     {         question: "Em relação ao músculo liso, marque a alternativa errada.",         options: [             "É formado pela associação de células longas, mais espessas no centro e afilando-se nas extremidades, com núcleo único e central.",             "O tamanho da célula muscular lisa pode variar de 20µm na parede dos pequenos vasos sanguíneos até 500µm no útero grávido.",             "Durante a gravidez, as fibras musculares lisas do útero apresentam apenas hiperplasia (aumento do número de células), sem sofrer a hipertrofia.",             "As células musculares lisas são revestidas por lâmina basal e mantidas juntas por uma rede muito delicada de fibras reticulares.",             "O músculo liso é controlado pelo sistema nervoso simpático e parassimpático.",         ],         correctAnswer: "Durante a gravidez, as fibras musculares lisas do útero apresentam apenas hiperplasia (aumento do número de células), sem sofrer a hipertrofia.",         comment: "O útero grávido sofre tanto hiperplasia (aumento do número) quanto hipertrofia (aumento do tamanho) das células musculares lisas sob estímulo hormonal.",         topic: "Músculo Liso"     }, ];

    function buildQuiz() {
      const output = [];
      questions.forEach((currentQuestion, questionNumber) => {
        const options = [];
        for (let i = 0; i < currentQuestion.options.length; i++) {
          options.push(`<label class="option" data-question="${questionNumber}" data-value="${currentQuestion.options[i]}"><img src="tesouras.png" class="scissor-icon" onclick="event.stopPropagation(); this.parentNode.classList.toggle('struck-through');">${currentQuestion.options[i]}</label>`);
        }
        output.push(`<div class="card" id="question-${questionNumber}" data-topic="${currentQuestion.topic}"><div class="question">${currentQuestion.question}</div><div class="options">${options.join("")}</div><div class="comment" id="comment-${questionNumber}"></div></div>`);
      });
      quizContainer.innerHTML = output.join("");
    }

    function showResults() {
      // Lógica de resultados... (simplificada para o exemplo)
    }

    document.addEventListener("click", function (event) {
        const clickedElement = event.target;
        const optionElement = clickedElement.closest('.option');
        if (optionElement) {
            if (clickedElement.classList.contains("scissor-icon")) {
                event.stopPropagation();
                optionElement.classList.toggle("struck-through");
            } else {
                const parentCard = optionElement.closest('.card');
                const currentQuestionOptions = parentCard.querySelectorAll('.option');
                currentQuestionOptions.forEach(opt => opt.classList.remove("selected"));
                optionElement.classList.add("selected");
            }
        }
    });

    generateNewQuestionsBtn.addEventListener("click", async function() {
        statusMessage.textContent = '⏳ Gerando novas perguntas...';
        generateNewQuestionsBtn.disabled = true;
        const topics = Object.keys(errorCountByTopic).filter(topic => (errorCountByTopic[topic] || 0) > 0);
        const topicsToSend = topics.length > 0 ? topics : ["fisiologia celular", "biologia"];
        try {
            const response = await fetch('https://www.quizia.xyz/quiz', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ topicos: topicsToSend }),
            });
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const data = await response.json();
            newQuestionsContent.innerHTML = '';
            if (data && data.html) {
                newQuestionsContent.innerHTML = data.html.replace(/```html|```/g, '');
                newQuestionsContent.querySelectorAll('.card').forEach((card) => {
                    const questionElement = card.querySelector('p');
                    if (questionElement && !questionElement.classList.contains('question')) questionElement.classList.add('question');
                    card.querySelectorAll('label').forEach((label) => {
                        const radioInput = label.querySelector('input[type="radio"]');
                        if (radioInput) {
                            if (radioInput.hasAttribute('data-answer')) label.setAttribute('data-answer', radioInput.getAttribute('data-answer'));
                            radioInput.remove();
                        }
                        if (!label.classList.contains('option')) label.classList.add('option');
                        if (!label.dataset.value) label.dataset.value = label.textContent.trim();
                        if (!label.querySelector('.scissor-icon')) {
                            const scissorIcon = document.createElement('img');
                            scissorIcon.src = 'tesouras.png';
                            scissorIcon.className = 'scissor-icon';
                            scissorIcon.onclick = function(e) { e.stopPropagation(); label.classList.toggle('struck-through'); };
                            label.insertBefore(scissorIcon, label.firstChild);
                        }
                    });
                });
            }
            generatedQuestionsSection.style.display = 'block';
            generatedQuestionsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            statusMessage.textContent = '✅ Perguntas geradas com sucesso!';
            setTimeout(() => { statusMessage.textContent = '' }, 3000);
        } catch (error) {
            console.error('Erro:', error);
            statusMessage.textContent = '❌ Erro: ' + error.message;
        } finally {
            generateNewQuestionsBtn.disabled = false;
        }
    });

    buildQuiz();
    document.getElementById("verifyAnswersBtn").addEventListener("click", showResults);
  </script>
  <script src="conexao_firebase.js"></script>
  <script src="navegacao.js"></script>
  <script type="module" src="padrao_simulado.js"></script>
</body>
</html>
