<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>SecondLook Atlas</title>
<style>
body { 
  font-family: Arial, sans-serif; 
  background:#111; 
  color:#eee; 
}

h1 { margin-bottom: 20px; }

h2 { 
  border-bottom:1px solid #444; 
  margin-top: 40px;
}

.row {
  display: flex;
  gap: 20px;
  margin-bottom: 30px;
  align-items: flex-start;
}

.card {
  background: #1b1b1b;
  padding: 10px;
  border-radius: 10px;
  width: 48%;
  text-align: center;
}

.card img {
  max-width: 100%;
  border-radius: 8px;
  margin-bottom: 6px;
}

.label {
  font-size: 13px;
  font-weight: bold;
  margin-bottom: 5px;
}

.label.q { color: #7dd3fc; }
.label.a { color: #86efac; }

.desc {
  font-size: 12px;
  color: #aaa;
  margin-top: 6px;
  line-height: 1.4;
}

.answer-stack img {
  margin-bottom: 10px;
}

</style>
</head>
<body>

<h1>SecondLook Histology Atlas</h1>
<div id="atlas"></div>

<script>
fetch('./atlas.json')
  .then(r => r.json())
  .then(data => {

    const root = document.getElementById("atlas");

    // 1) Agrupar por sistema
    const bySystem = {};
    data.forEach(x => {
      if (!bySystem[x.system]) bySystem[x.system] = [];
      bySystem[x.system].push(x);
    });

    for (const sys in bySystem) {

      const h = document.createElement("h2");
      h.textContent = sys;
      root.appendChild(h);

      // 2) Agrupar por prefixo do arquivo (sem (1).webp etc)
      const byBase = {};

      bySystem[sys].forEach(x => {

        // remove " (1).webp", " (2).webp" etc
        const base = x.file
          .replace(/\s*\(\d+\)\.webp$/i, "")
          .trim();

        if (!byBase[base]) byBase[base] = [];
        byBase[base].push(x);
      });

      for (const base in byBase) {

        // ordenar (1), (2), (3)...
        const items = byBase[base].sort((a,b) => {
          const na = parseInt(a.file.match(/\((\d+)\)\.webp$/i)?.[1] || 0);
          const nb = parseInt(b.file.match(/\((\d+)\)\.webp$/i)?.[1] || 0);
          return na - nb;
        });

        const row = document.createElement("div");
        row.className = "row";

        // esquerda = pergunta (primeira imagem)
        const qItem = items[0];

        const qCard = document.createElement("div");
        qCard.className = "card";
        qCard.innerHTML = `
          <div class="label q">PERGUNTA</div>
          <img src="./Histologia/Michigan/${qItem.file}" loading="lazy">
          <div class="desc">${qItem.question || base}</div>
        `;

        // direita = respostas (todas as outras)
        const aCard = document.createElement("div");
        aCard.className = "card";

        let answersHTML = "";
        items.slice(1).forEach(it => {
          answersHTML += `
            <img src="./Histologia/Michigan/${it.file}" loading="lazy">
          `;
        });

        aCard.innerHTML = `
          <div class="label a">RESPOSTA</div>
          <div class="answer-stack">
            ${answersHTML || "<div class='desc'>Resposta ausente</div>"}
          </div>
        `;

        row.appendChild(qCard);
        row.appendChild(aCard);
        root.appendChild(row);
      }
    }

  })
  .catch(err => {
    document.getElementById("atlas").innerHTML =
      "<p style='color:red'>Erro ao carregar atlas.json</p>";
    console.error(err);
  });
</script>

</body>
</html>
